package rv

import (
	"testing"
)

func TestImmI(t *testing.T) {
	testImm(t, "immI", immI, immTests{
		0b_100000000000_00000000000000000000: 0b_11111111111111111111100000000000,
		0b_010000000000_00000000000000000000: 0b_00000000000000000000010000000000,
		0b_001000000000_00000000000000000000: 0b_00000000000000000000001000000000,
		0b_000100000000_00000000000000000000: 0b_00000000000000000000000100000000,
		0b_000010000000_00000000000000000000: 0b_00000000000000000000000010000000,
		0b_000001000000_00000000000000000000: 0b_00000000000000000000000001000000,
		0b_000000100000_00000000000000000000: 0b_00000000000000000000000000100000,
		0b_000000010000_00000000000000000000: 0b_00000000000000000000000000010000,
		0b_000000001000_00000000000000000000: 0b_00000000000000000000000000001000,
		0b_000000000100_00000000000000000000: 0b_00000000000000000000000000000100,
		0b_000000000010_00000000000000000000: 0b_00000000000000000000000000000010,
		0b_000000000001_00000000000000000000: 0b_00000000000000000000000000000001,
		0b_000000000000_11111111111111111111: 0b_00000000000000000000000000000000,
		0b_111111111111_00000000000000000000: 0b_11111111111111111111111111111111,
		0b_111111111111_11111111111111111111: 0b_11111111111111111111111111111111,
	})
}

func TestImmS(t *testing.T) {
	testImm(t, "immS", immS, immTests{
		0b_0100001_0000000000000_10001_0000000: 0b_00000000000000000000_0100001_10001,
		0b_1000001_0000000000000_10001_0000000: 0b_11111111111111111111_1000001_10001,
	})
}

func TestImmB(t *testing.T) {
	testImm(t, "immB", immB, immTests{
		0b_0100001_0000000000000_1001_1_0000000: 0b_00000000000000000000_1_100001_1001_0,
		0b_1100001_0000000000000_1001_1_0000000: 0b_11111111111111111111_1_100001_1001_0,
	})
}

func TestImmU(t *testing.T) {
	testImm(t, "immU", immU, immTests{
		0b_01000000000000000001_100000000001: 0b_01000000000000000001_000000000000,
		0b_10000000000000000001_100000000001: 0b_10000000000000000001_000000000000,
	})
}

func TestImmJ(t *testing.T) {
	testImm(t, "immJ", immJ, immTests{
		0b_01000000001_1_10000001_000000000000: 0b_000000000000_10000001_1_1000000001_0,
		0b_11000000001_1_10000001_000000000000: 0b_111111111111_10000001_1_1000000001_0,
	})
}

type immTests map[uint32]uint32

func testImm(t *testing.T, fnName string, fn func(int32) int32, tests immTests) {
	tests[0] = 0 // include zero-to-zero test case

	for arg, want := range tests {
		if got := uint32(fn(int32(arg))); want != got {
			t.Errorf("%v(0b_%032b):\nwant 0b_%032b\n got 0b_%032b", fnName, arg, want, got)
		}
	}
}
